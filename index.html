<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุญุงูู ุจุฑูุชูููู ุฏุงุก ุงูููุจ ุงูุชูุงุนูู</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap');

        :root {
            --primary-color: #004e92;
            --secondary-color: #f8f9fa;
            --accent-color: #e5383b;
            --success-color: #38a700;
            --danger-color: #dc3545;
            --text-color: #212529;
            --header-color: var(--primary-color);
            --sidebar-width: 250px;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Cairo', sans-serif; 
            background-color: var(--secondary-color);
            background: linear-gradient(135deg, var(--secondary-color) 0%, #d4e0eb 100%);
            color: var(--text-color); 
            margin: 0; 
            min-height: 100vh;
            display: flex;
            justify-content: center;
        }

        .container { 
            display: flex; 
            width: 100%; 
            min-height: 100vh; 
            max-width: 900px;
            padding: 0;
            margin: 0;
            flex-direction: column; 
            align-items: center;
        }
        
        /* ุนูุงุตุฑ ุงูุชุญูู ุงูุนูููุฉ */
        .hamburger-menu, #back-button {
            position: fixed; 
            top: 20px; 
            z-index: 1001;
            background: var(--primary-color);
            color: #fff;
            border: none;
            border-radius: 8px;
            width: 40px; 
            height: 40px; 
            font-size: 1.2em; 
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
            display: flex; 
            align-items: center; 
            justify-content: center;
            transition: background-color 0.2s;
        }
        .hamburger-menu { right: 20px; } 
        #back-button { left: 20px; } 
        
        .hamburger-menu:active, #back-button:active {
            transform: scale(0.95);
        }
        .hamburger-menu:hover, #back-button:hover {
            background-color: #0066a5;
        }

        html[dir="ltr"] .hamburger-menu { right: auto; left: 20px; }
        html[dir="ltr"] #back-button { left: auto; right: 20px; } 

        /* ุงูุดุฑูุท ุงูุฌุงูุจู (ูุงุฆูุฉ ุงููุงูุจุฑุบุฑ) */
        .sidebar {
            width: var(--sidebar-width); 
            background: var(--text-color); 
            color: #fff;
            padding: 20px;
            position: fixed; 
            right: 0; 
            top: 0; 
            height: 100%; 
            transform: translateX(100%);
            z-index: 1000;
            transition: transform 0.3s ease-in-out;
            box-shadow: -4px 0 10px rgba(0,0,0,0.4);
            display: flex; 
            flex-direction: column;
        }
        html[dir="ltr"] .sidebar { 
             right: auto; left: 0; transform: translateX(-100%);
             box-shadow: 4px 0 10px rgba(0,0,0,0.4);
        }
        .sidebar.open { transform: translateX(0); }
        .sidebar h2 { color: var(--accent-color); border-bottom: 1px solid rgba(255, 255, 255, 0.2); padding-bottom: 10px; margin-bottom: 20px; }
        .sidebar ul { list-style: none; padding: 0; margin: 0; }
        .sidebar ul li a {
            display: block;
            padding: 10px 0;
            text-decoration: none;
            font-weight: 600;
            color: #ccc;
            transition: color 0.2s;
        }
        .sidebar ul li a:hover { color: var(--accent-color); }
        .sidebar ul li a.active { color: var(--accent-color); font-weight: 700; }
        #lang-toggle { background: var(--accent-color); color: var(--text-color); border-radius: 4px; padding: 5px 10px; margin-bottom: 15px; border: none; font-weight: 700;}


        /* ุงููุญุชูู ุงูุฑุฆูุณู */
        .main-content { 
            width: 100%;
            padding: 20px; 
            padding-top: 80px; 
            text-align: center;
        }
        
        /* ุชุตููู ุงูุจุทุงูุงุช (Clean Cards) */
        .card {
            background-color: #fff; 
            border-radius: 12px; 
            padding: 30px; 
            margin-bottom: 25px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); 
            border-top: 4px solid var(--primary-color);
            text-align: right;
            max-width: 600px;
            margin: 20px auto;
        }
        .card h3, .card h4 { 
            color: var(--header-color); 
            font-weight: 700;
            margin-top: 0;
            padding-bottom: 10px;
        }

        /* ุดุงุดุฉ ุจุฏุก ุงููุนุจุฉ */
        #start-screen h1 {
            color: var(--primary-color);
            font-size: 2.5em;
            margin-top: 50px;
        }
        #start-button {
            padding: 15px 40px;
            background-color: var(--accent-color);
            color: var(--text-color);
            border-radius: 10px;
            font-size: 1.3em;
            font-weight: 800;
            cursor: pointer;
            border: none;
            box-shadow: 0 4px var(--primary-color); 
            transition: all 0.1s;
        }
        #start-button:active {
            transform: translateY(4px);
            box-shadow: 0 0 var(--primary-color);
        }

        /* ุณููุงุฑูู ุงูุฅุฌุฑุงุกุงุช */
        .scenario-actions {
            display: flex;
            flex-direction: column;
            gap: 15px;
            text-align: right;
        }
        .action-option {
            padding: 15px;
            border-radius: 8px;
            border: 2px solid var(--primary-color);
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
            font-weight: 600;
            background-color: #fff;
            position: relative;
        }
        .action-option.selected {
            background-color: #e0f7fa;
            border-color: var(--accent-color);
        }
        
        /* ุงูุฃุฒุฑุงุฑ ูู ุดุงุดุฉ ุงูุณููุงุฑูู */
        #submit-scenario, #next-scenario, #skip-scenario {
            padding: 12px 20px; /* ุชุตุบูุฑ ุงููุงูุด ุงูุฏุงุฎูู ููููุงู */
            border-radius: 8px;
            margin: 10px 5px; /* ูุงูุด ุญูู ุงูุฃุฒุฑุงุฑ */
            font-weight: 700;
            border: none;
            cursor: pointer;
            display: inline-block;
        }
        #submit-scenario {
            background-color: var(--primary-color);
            color: white;
        }
        #next-scenario {
            background-color: var(--accent-color);
            color: var(--text-color);
        }
        #skip-scenario { /* ุชุตููู ุฒุฑ ุงูุชุฌุงูุฒ */
            background-color: #ccc;
            color: var(--text-color);
        }

        
        /* ุดุงุดุฉ ุงูุชูููู (Feedback) */
        .feedback-item {
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 10px;
            font-weight: 600;
            display: flex;
            align-items: center;
        }
        .feedback-item.correct { background-color: #e6ffe6; color: var(--success-color); border-right: 5px solid var(--success-color); }
        .feedback-item.incorrect { background-color: #ffe6e6; color: var(--danger-color); border-right: 5px solid var(--danger-color); }
        .feedback-item span { margin-left: 10px; font-size: 1.2em; }

        
        /* ุดุงุดุงุช ุณุทุญ ุงูููุชุจ */
        @media (min-width: 993px) {
             .container { max-width: 100%; flex-direction: row; align-items: flex-start; }
             .sidebar { transform: translateX(0); position: sticky; } 
             .main-content { 
                 padding-top: 40px; 
                 width: calc(100% - var(--sidebar-width)); 
                 margin: 0;
             }
             html[dir="rtl"] .main-content { 
                margin-right: var(--sidebar-width); 
             }
             html[dir="ltr"] .main-content { 
                margin-left: var(--sidebar-width); 
             }
             .hamburger-menu, #back-button { display: none !important; }
        }
    </style>
</head>
<body>
    
    <!-- ุฒุฑ ุงูุฑุฌูุน (ูุธูุฑ ููุท ุนูู ุงูุฌูุงู) -->
    <button id="back-button">
        &larr;
    </button>
    <button class="hamburger-menu" id="hamburger-menu">โฐ</button>
    
    <div class="container">
        <!-- ุงูุดุฑูุท ุงูุฌุงูุจู (ูุณุชุฎุฏู ุงูุขู ููุงุฆูุฉ ุชููู) -->
        <nav class="sidebar" id="sidebar">
             <!-- Sidebar content will be populated by JavaScript -->
        </nav>
        <main class="main-content" id="main-content">
             <!-- ุงููุญุชูู ุณูุจุฏุฃ ุจุดุงุดุฉ ุงูุจุฏุก -->
        </main>
    </div>

    <script>
        /* 
            [ุฅุดุนุงุฑ ุญููู ุงููุดุฑ ูุงูููููุฉ]
            ------------------------------------------------------------------
            ุงููุฑุฌุน ุงูุชูุงุนูู ูุจุฑูุชูููู ุฏุงุก ุงูููุจ (Rabies Protocol Interactive Guide)
            ุงููุทูุฑ: ุญููุฏูุด ุนุจุฏ ุงูุชูุงุจ (Hamidouche Abdeetouab)
            ุงูุชุฎุตุต: ูุฎุชุต ูู ุญูุธ ุงูุตุญุฉ
            ุงููุคุณุณุฉ: ูุตูุญุฉ ุนูู ุงูุฃูุจุฆุฉ ูุงูุทุจ ุงูููุงุฆูุ ุงููุคุณุณุฉ ุงูุนููููุฉ ููุตุญุฉ ุงูุฌูุงุฑูุฉุ ุจุฑุฌ ููุงูู.
            ุงูุจุฑูุฏ ุงูุฅููุชุฑููู: abdeetouab@gmail.com
            ุณูุฉ ุงูุฅูุดุงุก: 2024.
            ------------------------------------------------------------------
        */
        
        let currentLang = 'ar'; 
        let currentScenarioIndex = 0;
        let userAnswers = [];
        let shuffledScenarios = []; 

        function shuffleArray(array) {
            let newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // =========================================================
        // 1. ุงูุจูุงูุงุช (ุงูุณููุงุฑูููุงุช ุงูู 30)
        // =========================================================

        const scenariosMaster = {
            ar: [
                { title: "ุงูุณููุงุฑูู 1: ุงูุฎุฏุด ุงูุณุทุญู", description: "ุทูู (7 ุณููุงุช) ุชุนุฑุถ ูุฎุฏุด ุจูุงุณุทุฉ ูุทุฉ ุถุงูุฉ ูู ุณุงููุ ุงูุฎุฏุด ุณุทุญู ููุง ููุฒูุ ูุงููุทุฉ ูุฑุจุช.", options: [ { text: "ุบุณู ุงูุฌุฑุญ ุจุงููุงุก ูุงูุตุงุจูู 15 ุฏูููุฉ.", correct: true }, { text: "ุชุทููุฑ ุงูุฌุฑุญ ุจุงููุญูู ุฃู ุงูููุฏ.", correct: true }, { text: "ุชุทุนูู ููุฑู ุจู VAR-VC (ุงูููุงุญ ุงูุฎููู).", correct: true }, { text: "ุญูู ุงูุบููุจููููู ุงูููุงุนู (IGAR).", correct: false }, { text: "ุฎูุงุทุฉ ุงูุฌุฑุญ ููุฑูุง.", correct: false }, { text: "ูุฑุงูุจุฉ ุงููุทุฉ ููุฏุฉ 15 ูููุงู ูุจู ุจุฏุก ุงูุนูุงุฌ.", correct: false }, ], category: "ุงููุฆุฉ II" },
                { title: "ุงูุณููุงุฑูู 2: ุนุถุฉ ุงูุซุนูุจ ุงูุจุฑู", description: "ุดุงุจ ุชุนุฑุถ ูุนุถุฉ ุนูููุฉ ููุงุฒูุฉ ูู ุฅุตุจุน ูุฏูุ ุงูุญููุงู ุงูููุงุฌู ูู ุซุนูุจ ุจุฑู ุชู ูุชูู ูู ุงูููุงู.", options: [ { text: "ุบุณู ูุชุทููุฑ ุงูุฌุฑุญ 15 ุฏูููุฉ.", correct: true }, { text: "ุชุทุนูู ููุฑู ุจู VAR-VC.", correct: true }, { text: "ุญูู IGAR ููุถุนูุงู ุญูู ุงูุฌุฑุญ.", correct: true }, { text: "ุฅุฑุณุงู ุฑุฃุณ ุงูุซุนูุจ ูููุญุต ุงููุนููู.", correct: true }, { text: "ุฅุนุทุงุก ุงููุตู ุนู ุทุฑูู ุงูุนุถู ููุท.", correct: false }, ], category: "ุงููุฆุฉ III" },
                { title: "ุงูุณููุงุฑูู 3: ูุนู ุนูู ุฌูุฏ ุณููู", description: "ูุฒุงุฑุน ุชุนุฑุถ ููุนู ููุจ ูุงู ูุทุนูู ุนูู ุฌูุฏ ุณููู ุชูุงูุงูุ ุจุฏูู ูุฌูุฏ ุฃู ุฌุฑูุญ ุฃู ุฎุฏูุด.", options: [ { text: "ุบุณู ุงูููุทูุฉ ุจุงููุงุก ูุงูุตุงุจูู.", correct: true }, { text: "ุชุทุนูู ุจู VAR-VC.", correct: false }, { text: "ุฅุนุทุงุก IGAR.", correct: false }, { text: "ูุฑุงูุจุฉ ุงูููุจ ููุฏุฉ 15 ูููุงู.", correct: true }, { text: "ูุง ุฏุงุนู ูุฃู ุนูุงุฌ ููุงุฆู.", correct: true }, ], category: "ุงููุฆุฉ I" },
                { title: "ุงูุณููุงุฑูู 4: ููุต ุงูููุงุนุฉ", description: "ูุฑูุถ ูุชููู ุนูุงุฌุงู ููููุงุฆูุงู (ูุงูุต ููุงุนุฉ) ุชุนุฑุถ ูุฎุฏุด ุจุณูุท ููุงุฒู ูู ูุทุฉ ุถุงูุฉ.", options: [ { text: "ุบุณู ูุชุทููุฑ ุงูุฌุฑุญ.", correct: true }, { text: "ุชุทุนูู ููุฑู ุจู VAR-VC.", correct: true }, { text: "ุญูู IGAR (ุงูุบููุจููููู ุงูููุงุนู).", correct: true }, { text: "ุชุฃุฌูู ุงูุนูุงุฌ ูุญูู ุงุณุชูุฑุงุฑ ููุงุนุฉ ุงููุฑูุถ.", correct: false }, { text: "ุงูุชุดุงู ููุน ุงูููุงุญ (ุฎููู ุฃู ุนุตุจู) ูุจู ุงูุจุฏุก.", correct: false }, ], category: "ุญุงูุฉ ุฎุงุตุฉ" },
                { title: "ุงูุณููุงุฑูู 5: ุนุถุฉ ูุฃุฑ", description: "ุนุงูู ูู ูุฎุฒู ุชุนุฑุถ ูุนุถุฉ ุฎูููุฉ ูู ูุฃุฑ (ุฌุฑุฐ) ุฃุฏุช ูุจุนุถ ุงููุฒูู.", options: [ { text: "ุบุณู ุงูุฌุฑุญ ุฌูุฏุงู.", correct: true }, { text: "ุชุทููุฑ ุงูุฌุฑุญ.", correct: true }, { text: "ุฅุนุทุงุก ุงูููุงุญ ูุงููุตู ููุฑุงู.", correct: false }, { text: "ูุง ุฏุงุนู ููุนูุงุฌ ุงูููุงุฆู ุถุฏ ุงูุณุนุงุฑ.", correct: true }, ], category: "ุญููุงูุงุช ุบูุฑ ุฎุทุฑุฉ" },
                { title: "ุงูุณููุงุฑูู 6: ุชุฃุฎูุฑ ุงูููุงุญ ุงูุนุตุจู", description: "ูุฑูุถ ูุชููู ุงูููุงุญ ุงูุนุตุจู (VAR-TN) ูุชุฃุฎุฑ ุนู ููุนุฏ ุฌุฑุนุฉ ุงูููู ุงูุซุงูุซ (J3) ุจู 48 ุณุงุนุฉ.", options: [ { text: "ูููู ุงูุฌุฏูู ุงูุฒููู ุนุงุฏูุงู.", correct: false }, { text: "ูุฌุจ ุฅุนุงุฏุฉ ุงูุณูุณูุฉ ูุงููุฉ.", correct: true }, { text: "ูุชุญูู ุฅูู ุงูููุงุญ ุงูุฎููู.", correct: false }, ], category: "ุฅุฌุฑุงุกุงุช ูุชูุฏูุฉ" },
                { title: "ุงูุณููุงุฑูู 7: ุนุถุฉ ูู ุงููุฌู", description: "ุดุฎุต ุชุนุฑุถ ูุนุถุฉ ูุงุฒูุฉ ูู ููุจ ุถุงู ูู ุดูุชูู ุงูุนูููุฉ (ุงููุฌู).", options: [ { text: "ุบุณู ุงูุฌุฑุญ 15 ุฏูููุฉ.", correct: true }, { text: "ุชุทุนูู VAR-VC ููุฑุงู.", correct: true }, { text: "ุญูู IGAR ููุถุนูุงู ูู ุงูุดูุฉ.", correct: true }, { text: "ุชุฃุฌูู IGAR ูุญูู ุงูุชุฃูุฏ ูู ุณูุนุงุฑ ุงูููุจ.", correct: false }, ], category: "ุงููุฆุฉ III" },
                { title: "ุงูุณููุงุฑูู 8: ูููุญ ุณุงุจูุงู", description: "ููุฑุถ ุชููู ุชุทุนููุงู ูุงููุงู ุถุฏ ุงูุณุนุงุฑ ูุจู 3 ุณููุงุชุ ุชุนุฑุถ ูุฎุฏุด ุนููู ูู ูุทุฉ.", options: [ { text: "ุบุณู ูุชุทููุฑ ุงูุฌุฑุญ.", correct: true }, { text: "ุฅุนุทุงุก ุจุฑูุชูููู ุงูุนูุฏุฉ (ุฌุฑุนุชูู VAR-VC).", correct: true }, { text: "ุญูู IGAR.", correct: false }, { text: "ุฅุนุทุงุก 4 ุฌุฑุนุงุช ุฌุฏูุฏุฉ.", correct: false }, ], category: "ูููุญ ุณุงุจูุงู" },
                { title: "ุงูุณููุงุฑูู 9: ูุนู ุนูู ุฌุฑุญ ููุชูุญ", description: "ุทูู ุชุนุฑุถ ููุนู ููุจ ุถุงู ูู ุฌุฑุญ ููุชูุญ ูุงู ูุงุชุฌุงู ุนู ุณููุท ูุฏูู.", options: [ { text: "ุบุณู ููุฑู ููุฌุฑุญ.", correct: true }, { text: "ุชุทุนูู VAR-VC.", correct: true }, { text: "ุญูู IGAR.", correct: true }, { text: "ูุนุชุจุฑ ูุฆุฉ I ููุง ูุญุชุงุฌ ูุนูุงุฌ.", correct: false }, ], category: "ุงููุฆุฉ III" },
                { title: "ุงูุณููุงุฑูู 10: ููุจ ูุนุฑูู", description: "ุนุถุฉ ุบูุฑ ูุงุฒูุฉ ูู ููุจ ุฌุงุฑ ูุนุฑูู ูููุซูุ ูุงูููุจ ูุถุน ุชุญุช ุงููุฑุงูุจุฉ ุงูุจูุทุฑูุฉ.", options: [ { text: "ุงูุจุฏุก ููุฑุงู ุจุงูููุงุญ.", correct: true }, { text: "ููู ุงูููุงุญ ุฅุฐุง ูุงู ุงูููุจ ุณูููุงู ุจุนุฏ 15 ูููุงู.", correct: true }, { text: "ุงูุชุธุงุฑ ูุชูุฌุฉ ุงููุฑุงูุจุฉ 15 ูููุงู ูุจู ุงูุจุฏุก.", correct: false }, { text: "ุญูู IGAR.", correct: false }, ], category: "ุงููุฆุฉ II + ูุฑุงูุจุฉ" },
                { title: "ุงูุณููุงุฑูู 11: ุนุถุฉ ูู ุงููุฏ", description: "ุนุถุฉ ุจุณูุทุฉ ููููุง ูู ุชูุฒู (ุบูุฑ ุนูููุฉ) ูู ุฑุงุญุฉ ุงููุฏ ูู ูุทุฉ ุถุงูุฉ.", options: [ { text: "ุชุนุชุจุฑ ูุฆุฉ II ูุชุชุทูุจ ููุงุญ ููุท.", correct: false }, { text: "ุชุนุชุจุฑ ูุฆุฉ III (ุจุณุจุจ ุงููููุน) ูุชุชุทูุจ IGAR + ููุงุญ.", correct: true }, { text: "ุบุณู ุงูุฌุฑุญ.", correct: true }, ], category: "ุงููุฆุฉ III" },
                { title: "ุงูุณููุงุฑูู 12: ุชุฃุฎูุฑ ุงูููุงุญ ุงูุฎููู", description: "ูุฑูุถ ูุชููู ุงูููุงุญ ุงูุฎููู (VAR-VC) ูุชุฃุฎุฑ ุนู ุฌุฑุนุฉ ุงูููู ุงูุณุงุจุน (J7) ุจู 48 ุณุงุนุฉ.", options: [ { text: "ูุฌุจ ุฅุนุงุฏุฉ ุงูุณูุณูุฉ ูุงููุฉ.", correct: false }, { text: "ูููู ุงูุฌุฏูู ุงูุฒููู ุนุงุฏููุง ุฏูู ุฅุนุงุฏุฉ ุงูุจุฏุก.", correct: true }, { text: "ูุญุชุงุฌ ูุฌุฑุนุฉ ุฅุถุงููุฉ.", correct: false }, ], category: "VAR-VC ุงูุฅุฌุฑุงุก" },
                { title: "ุงูุณููุงุฑูู 13: ุญููุงู ุฃููู ููููุญ", description: "ุชุนุฑุถ ุดุฎุต ูุฎุฏุด ูุงุฒู ูู ููุจู ุงูุฎุงุต ุงูุฐู ุชููู ุฌููุน ุชุทุนููุงุชู ุงูุณูููุฉ ุจุงูุชุธุงู.", options: [ { text: "ูุชููู ุงูุนูุงุฌ ุงููุงูู (ููุงุญ + ูุตู).", correct: false }, { text: "ูุชู ุบุณู ุงูุฌุฑุญ ูุชุทููุฑู.", correct: true }, { text: "ูุชู ุงูุชุญูู ูู ุณุฌู ุชุทุนูู ุงูููุจ.", correct: true }, { text: "ูุง ูุญุชุงุฌ ุนูุงุฌ ุทุงููุง ุงูููุจ ููููุญ (ูุน ุงูุบุณู).", correct: true }, ], category: "ูุฆุฉ II (ุญููุงู ููููุญ)" },
                { title: "ุงูุณููุงุฑูู 14: ุทุฑููุฉ ุฅุนุทุงุก ุงููุตู", description: "ูุฑูุถ ูุญุชุงุฌ ูู IGAR. ูุฏูู ุฌุฑุญ ุณุทุญู ุตุบูุฑ ููููุฉ ูุจูุฑุฉ ูู ุงููุตู. ูุง ูู ุงูุฅุฌุฑุงุก ุงูุฃูุซูุ", options: [ { text: "ุญูู ูู ุงููููุฉ ูู ุงูุนุถู ูู ุงููุคุฎุฑุฉ.", correct: false }, { text: "ุญูู ูุนุธู ุงููููุฉ ุญูู ุงูุฌุฑุญ ูุงูุจุงูู ูู ุงูุนุถู.", correct: true }, { text: "ุงูุชุฎูุต ูู ุงููููุฉ ุงูุฒุงุฆุฏุฉ ุฅุฐุง ูู ูุชุณุน ุงูุฌุฑุญ.", correct: false }, ], category: "IGAR" },
                { title: "ุงูุณููุงุฑูู 15: ุงููุฑุฃุฉ ุงูุญุงูู", description: "ุงูุฑุฃุฉ ุญุงูู ุชุนุฑุถุช ูุนุถุฉ ูุฆุฉ III (ุฎุทูุฑุฉ).", options: [ { text: "ูุชู ุฅุนุทุงุก ุงูููุงุญ ููุท ุฏูู ุงููุตู.", correct: false }, { text: "ูุชู ุชุฃุฌูู ุงูุนูุงุฌ ุญุชู ุงูููุงุฏุฉ.", correct: false }, { text: "ูุฌุจ ุฅุนุทุงุก ุงูุนูุงุฌ ุงููุงูู (ููุงุญ + IGAR) ููุฑุงู.", correct: true }, ], category: "ุญุงูุงุช ุฎุงุตุฉ" },
                { title: "ุงูุณููุงุฑูู 16: ุงูููุงูุฉ ูุจู ุงูุชุนุฑุถ (PPrEx)", description: "ุทุจูุจ ุจูุทุฑู ุชููู ุชุทุนููุงู ููุงุฆูุงู ูุงููุงู (PPrEx). ุชุนุฑุถ ูุฎุฏุด ุนููู ููุงุฒู.", options: [ { text: "ูุญุชุงุฌ ูุจุฑูุชูููู ูุงูู (IGAR + 4 ุฌุฑุนุงุช).", correct: false }, { text: "ูุญุชุงุฌ ูุฌุฑุนุชู ุนูุฏุฉ ููุท (J0, J3) ููุง ูุญุชุงุฌ IGAR.", correct: true }, { text: "ูุญุชุงุฌ ูุฌุฑุนุชู ุนูุฏุฉ ูุน IGAR.", correct: false }, ], category: "PPrEx" },
                { title: "ุงูุณููุงุฑูู 17: ุฎูุท ุงูููุงุญุงุช", description: "ูุฑูุถ ุจุฏุฃ ุงูููุงุญ ุงูุนุตุจู (VAR-TN)ุ ูููุฏ ุงููุฎุฒูู. ูู ููููู ุงูุชุญูู ุฅูู ุงูุฎููู (VAR-VC) ูุฅููุงู ุงูุณูุณูุฉุ", options: [ { text: "ูุนูุ ูููู ุงูุฎูุท ุทุงููุง ููุงููุง ุถุฏ ุงูุณุนุงุฑ.", correct: false }, { text: "ูุงุ ูุฌุจ ุนุฏู ุฎูุท ุงูููุนูู ูู ููุณ ุงูุณูุณูุฉ.", correct: true }, { text: "ูุฌุจ ุฅุนุงุฏุฉ ุงูุณูุณูุฉ ุจุงุณุชุฎุฏุงู ุงูุฎููู.", correct: false }, ], category: "VAR-VC/VAR-TN" },
                { title: "ุงูุณููุงุฑูู 18: ุนุถุฉ ูุฑุฏ (ุญููุงู ุจุฑู)", description: "ุชุนุฑุถ ุดุฎุต ูุนุถุฉ ุนูููุฉ ูู ูุฑุฏ (ูุนุชุจุฑ ุญููุงู ุจุฑู/ุบูุฑ ุฃููู).", options: [ { text: "ูุฆุฉ Iุ ุบุณู ููุท.", correct: false }, { text: "ูุนุชุจุฑ ูุฆุฉ IIIุ ููุชููู IGAR + ููุงุญ.", correct: true }, { text: "ูุชููู ุงูููุงุญ ููุท.", correct: false }, ], category: "ุงููุฆุฉ III" },
                { title: "ุงูุณููุงุฑูู 19: ุฅููุงู ุงูุนูุงุฌ", description: "ูุฑูุถ ุจุฏุฃ ุงูุนูุงุฌ ุงูููุงุฆู. ูุชู ูููู ุฅููุงู ุงูุนูุงุฌ ุจุฃูุงูุ", options: [ { text: "ุจุนุฏ ุฃุฎุฐ ุงูุฌุฑุนุฉ ุงูุซุงููุฉ.", correct: false }, { text: "ุฅุฐุง ุซุจุช ุฃู ุงูุญููุงู ุงูููุงุฌู ุณููู ุจุนุฏ 10 ุฃูุงู ูู ุงููุฑุงูุจุฉ.", correct: true }, { text: "ุจุนุฏ 15 ูููุงู ูู ุงูุนุถุฉ ุจุบุถ ุงููุธุฑ ุนู ุญุงูุฉ ุงูุญููุงู.", correct: false }, ], category: "ุงููุฑุงูุจุฉ" },
                { title: "ุงูุณููุงุฑูู 20: ุงูููุงูุฉ ุงูุนุงูุฉ", description: "ูุง ูู ุฎุท ุงูุฏูุงุน ุงูุฃูู ูุงูุฃูุซุฑ ูุนุงููุฉ ุนูู ุงููุณุชูู ุงููุฌุชูุนู ุถุฏ ุฏุงุก ุงูููุจุ", options: [ { text: "ุชุทุจูู ุงูุนูุงุฌ ุงููุงูู ูุฌููุน ุงููุตุงุจูู.", correct: false }, { text: "ุงูุชุทุนูู ุงูููุชุธู ููููุงุจ ูุงููุทุท ุงูุฃูููุฉ.", correct: true }, { text: "ุจูุงุก ูุฑุงูุฒ ุนุฒู ูุจูุฑุฉ.", correct: false }, ], category: "ุงูููุงูุฉ" },

                // ุณููุงุฑูููุงุช ุงูุชูููุญ ุงููุชูุฏูุฉ (21-30)
                { title: "ุงูุณููุงุฑูู 21: ุจุฑูุชูููู ุฒุบุฑุจ (ุงูุฃูุงู)", description: "ูุดุฎุต ุบูุฑ ูููุญ ูุชุนุฑุถ ูุนุถุฉ ูุฆุฉ IIุ ูุง ูู ุฃูุงู ุงูุฌุฑุนุงุช ูู ุจุฑูุชูููู ุฒุบุฑุจ (VAR-VC)ุ", options: [ { text: "J0, J7, J14, J28", correct: false }, { text: "J0 (ุฌุฑุนุชุงู), J7, J21", correct: true }, { text: "J0, J3, J7, J14", correct: false }, ], category: "ุจุฑูุชูููู ุฒุบุฑุจ" },
                { title: "ุงูุณููุงุฑูู 22: ุจุฑูุชูููู ุฅูุณู (ุงูุฃูุงู)", description: "ูุดุฎุต ุบูุฑ ูููุญ ูุชุนุฑุถ ูุนุถุฉ ูุฆุฉ IIุ ูุง ูู ุฃูุงู ุงูุฌุฑุนุงุช ูู ุจุฑูุชูููู ุฅูุณู (VAR-VC)ุ", options: [ { text: "J0, J7, J21", correct: false }, { text: "J0, J3, J7, J14", correct: true }, { text: "J0 (ุฌุฑุนุชุงู), J7, J14", correct: false }, ], category: "ุจุฑูุชูููู ุฅูุณู" },
                { title: "ุงูุณููุงุฑูู 23: ุญูู ุงูููุงุญ ูู ุงูุฃุฑุฏุงู", description: "ุชู ุญูู ุงูููุงุญ ุงูุฎููู (VAR-VC) ูู ุงูุฃุฑุฏุงู ููุฑูุถ ุจุงูุบ. ูุง ูู ุงูุฎุทุฑุ", options: [ { text: "ูุฒูุฏ ูู ุงูุฃูู.", correct: false }, { text: "ูุง ููุฌุฏ ุฎุทุฑ.", correct: false }, { text: "ูููู ูู ูุนุงููุฉ ุงูููุงุญ ุจุดูู ูุจูุฑ.", correct: true }, ], category: "ุทุฑููุฉ ุงูุญูู" },
                { title: "ุงูุณููุงุฑูู 24: ุงูุฅุนุทุงุก ุฏุงุฎู ุงูุฃุฏูุฉ (ID)", description: "ูุชู ุงุณุชุฎุฏุงู ุงูุญูู ุฏุงุฎู ุงูุฃุฏูุฉ (ID) ุจุฌุฑุนุงุช 0.1 ูู ูููุงุญ ุงูุฎููู ูุฅุฌุฑุงุก ุชูููุฑู. ูุง ูู ุงูุฅุฌุฑุงุก ุงูุตุญูุญ ูู ูุฐู ุงูุญุงูุฉ ูุดุฎุต ุบูุฑ ูููุญุ", options: [ { text: "ุฌุฑุนุฉ ูุงุญุฏุฉ ูู ูููุน ูุงุญุฏ ูู J0, J3, J7.", correct: false }, { text: "ุฌุฑุนุชุงู ูู ูููุนูู ูุฎุชูููู ูู J0, J3, J7.", correct: true }, { text: "4 ุฌุฑุนุงุช ูู ูููุน ูุงุญุฏ ูู J0 ููุท.", correct: false }, ], category: "ุงูุฌุฑุนุฉ ุงูุชูููุฑูุฉ" },
                { title: "ุงูุณููุงุฑูู 25: IGAR ูุงููููุญ ุณุงุจูุงู", description: "ุดุฎุต ูููุญ ุณุงุจูุงู ุถุฏ ุงูุณุนุงุฑ ูุชุนุฑุถ ูุนุถุฉ ูุฆุฉ III. ูู ูุญุชุงุฌ IGARุ", options: [ { text: "ูุนูุ ูุญุชุงุฌู ุฏุงุฆูุงู ูู ุงููุฆุฉ III.", correct: false }, { text: "ูุงุ ูุง ูุญุชุงุฌ IGAR.", correct: true }, { text: "ูุญุชุงุฌู ุฅุฐุง ูุงูุช ุงูุนุถุฉ ูู ุงูุฑุฃุณ.", correct: false }, ], category: "PPrEx" },
                { title: "ุงูุณููุงุฑูู 26: ุจุฑูุชูููู ุงูููุงุญ ุงูุนุตุจู", description: "ุดุฎุต ุบูุฑ ูููุญ ูุชุนุฑุถ ูุนุถุฉ ูุฆุฉ IIIุ ููุชููู ุงูููุงุญ ุงูุนุตุจู (VAR-TN). ูุง ูู ุนุฏุฏ ุงูุฌุฑุนุงุช ุงูุฅุฌูุงููุ", options: [ { text: "4 ุฌุฑุนุงุช", correct: false }, { text: "6 ุฌุฑุนุงุช", correct: true }, { text: "ุฌุฑุนุชุงู ููุท", correct: false }, ], category: "VAR-TN" },
                { title: "ุงูุณููุงุฑูู 27: ุญุงูุฉ ุชุฃุฎุฑ ูุชูุฏูุฉ", description: "ูุฑูุถ ุชุนุฑุถ ูุนุถุฉ ูุจู 6 ุฃุดูุฑ ููู ูุชูู ุฃู ุนูุงุฌ. ูู ูุฌุจ ุงูุจุฏุก ุจุงูุนูุงุฌ ุงูููุงุฆู ุงูุขูุ", options: [ { text: "ูุงุ ูุง ูุงุฆุฏุฉ ุจุนุฏ 3 ุฃุดูุฑ.", correct: false }, { text: "ูุนูุ ูุฌุจ ุงูุจุฏุก ููุฑุงู.", correct: true }, { text: "ูุนูุ ููู IGAR ููุท.", correct: false }, ], category: "ุงูุชุฃุฎูุฑ" },
                { title: "ุงูุณููุงุฑูู 28: ุงูุชูููุญ ุงููุชูุฑุฑ", description: "ุดุฎุต ูุชููู ุงูููุงุญ ุงูุฎููู. ูู ูุฌุจ ุฅุนุงุฏุฉ ูุญุต ุงูุฃุฌุณุงู ุงููุถุงุฏุฉ (Titration) ุจุนุฏ ูู ุณูุณูุฉ ุนูุงุฌุ", options: [ { text: "ูุนูุ ุฏุงุฆูุงู.", correct: false }, { text: "ูุงุ ุฅูุง ุฅุฐุง ูุงู ุงููุฑูุถ ูุงูุต ููุงุนุฉ.", correct: true }, { text: "ูุงุ ุฃุจุฏุงู.", correct: false }, ], category: "ุงููุฑุงูุจุฉ" },
                { title: "ุงูุณููุงุฑูู 29: ุงูููุงุญ ุงูุนุตุจู ูู ุงูุฃุฏูุฉ", description: "ูุฌุจ ุฅุนุทุงุก ุงูููุงุญ ุงูุนุตุจู (VAR-TN):", options: [ { text: "ุนุถูู ููุท.", correct: true }, { text: "ุฏุงุฎู ุงูุฃุฏูุฉ (ID).", correct: false }, { text: "ุชุญุช ุงูุฌูุฏ (SC).", correct: false }, ], category: "VAR-TN" },
                { title: "ุงูุณููุงุฑูู 30: ุงูุฅุฌุฑุงุก ุงูุฅุฏุงุฑู ุนูุฏ ุงููุฑุงูุจุฉ", description: "ุฅุฐุง ุชูุฑุฑ ูุฑุงูุจุฉ ููุจ ููุฏุฉ 15 ูููุงู ุจุนุฏ ุงูุนุถุฉุ ูุชู ูุชู ุฅููุงู ุงูููุงุญ ุงูุฐู ุจุฏุฃูุงูุ", options: [ { text: "ููุฑ ุจุฏุก ุงููุฑุงูุจุฉ.", correct: false }, { text: "ุจุนุฏ ูุฑูุฑ 5 ุฃูุงู ูู ุงููุฑุงูุจุฉ.", correct: false }, { text: "ุฅุฐุง ุธู ุงูุญููุงู ุณูููุงู ุญูุงู ุญุชู ุงูููู ุงูุฎุงูุณ ุนุดุฑ.", correct: true }, ], category: "ุงููุฑุงูุจุฉ" },
            ],
            // ุงูุจูุงูุงุช ุงููุฑูุณูุฉ ูุญุฐููุฉ ููุชุฎููู
        };

        // =========================================================
        // 2. ุงูุฏูุงู ุงููุณุงุนุฏุฉ
        // =========================================================

        const copyrightAr = `
            <div style="padding: 15px; font-size: 0.8em; color: #666; margin-top: 30px; border-top: 1px solid #eee;">
                <p style="margin: 5px 0;">ุญููู ุงููุดุฑ ยฉ 2024. ุฌููุน ุงูุญููู ูุญููุธุฉ.</p>
                <p style="margin: 5px 0;">ุงููุทูุฑ: ุญููุฏูุด ุนุจุฏ ุงูุชูุงุจุ ุงููุคุณุณุฉ ุงูุนููููุฉ ููุตุญุฉ ุงูุฌูุงุฑูุฉ ุจุฑุฌ ููุงูู.</p>
            </div>
        `;

        function setBackButtonSymbol(lang) {
             const symbol = (lang === 'ar') ? '&#8594;' : '&larr;'; 
             document.getElementById('back-button').innerHTML = symbol;
        }

        // --- ูุงุฌูุฉ ุดุงุดุฉ ุงูุจุฏุก (Start Screen) ---
        function generateStartScreen(lang) {
            const data = contentData[lang];
            const scenariosCount = scenariosMaster[lang].length;
            return `
                <div id="start-screen" class="card" style="text-align: center; max-width: 500px;">
                    <h1>${lang === 'ar' ? 'ูุญุงูู ุจุฑูุชูููู ุฏุงุก ุงูููุจ' : 'Simulateur Protocole Antirabique'}</h1>
                    <p style="font-size: 1.1em; color: var(--header-color); margin-bottom: 30px;">
                        ${lang === 'ar' ? 'ุงุฎุชุจุฑ ูุนูููุงุชู ูู ุงูุฅุฌุฑุงุกุงุช ุงูููุฑูุฉ ูุงูููุงุฆูุฉ ููุชุนุงูู ูุน ุญุงูุงุช ุงูุชุนุฑุถ ููุณุนุงุฑ.' : 'Testez vos connaissances sur les mesures immรฉdiates et la prophylaxie de la rage.'}
                    </p>
                    <p style="font-weight: 700; color: var(--accent-color);">
                        ${lang === 'ar' ? `ุงููุญุงูู ูุญุชูู ุนูู ${scenariosCount} ุณููุงุฑูููุงุช ุนุดูุงุฆูุฉ.` : `Le simulateur contient ${scenariosCount} scรฉnarios alรฉatoires.`}
                    </p>
                    <button id="start-button">${lang === 'ar' ? 'ุจุฏุก ุงููุนุจุฉ' : 'Dรฉmarrer le Jeu'}</button>
                </div>
            `;
        }
        
        // --- ูุงุฌูุฉ ุงูุณููุงุฑูู (Scenario Screen) ---
        function generateScenarioHTML(lang, scenarioIndex) {
            const scenario = shuffledScenarios[scenarioIndex]; 
            const isSubmitted = userAnswers[scenarioIndex] !== undefined;
            const totalScenarios = scenariosMaster[lang].length;

            let optionsHtml = scenario.options.map((option, index) => {
                let classes = 'action-option';
                let icon = '';
                
                if (isSubmitted) {
                    const isSelected = userAnswers[scenarioIndex].selected.includes(index);
                    if (isSelected) {
                        classes += option.correct ? ' correct' : ' incorrect';
                        icon = option.correct ? 'โ' : 'โ';
                    } else if (option.correct) {
                        classes += ' correct';
                        icon = 'โ';
                    }
                } else if (userAnswers.length > scenarioIndex) {
                     const isSelected = userAnswers[scenarioIndex].selected.includes(index);
                     if (isSelected) classes += ' selected';
                }
                
                return `<div class="${classes}" data-index="${index}" ${isSubmitted ? 'style="pointer-events: none;"' : ''}>${option.text} <span style="float: left; color: inherit;">${icon}</span></div>`;
            }).join('');
            
            const feedbackScreen = isSubmitted ? generateFeedback(lang, scenarioIndex) : '';

            return `
                <div class="card">
                    <h3 style="color: var(--accent-color);">${lang === 'ar' ? 'ุงูุณููุงุฑูู' : 'Scรฉnario'} ${scenarioIndex + 1} / ${totalScenarios}</h3>
                    <p style="font-size: 1.1em; font-weight: 600; color: var(--header-color);">${scenario.title}</p>
                    <p>${scenario.description}</p>
                    
                    <h4 style="margin-top: 30px;">${lang === 'ar' ? 'ุงุฎุชุฑ ุฌููุน ุงูุฅุฌุฑุงุกุงุช ุงูุตุญูุญุฉ (ูุฏ ูููู ููุงู ุฃูุซุฑ ูู ุฎูุงุฑ):' : 'Sรฉlectionnez toutes les actions correctes (plusieurs choix possibles):'}</h4>
                    
                    <div id="action-options" class="scenario-actions">
                        ${optionsHtml}
                    </div>

                    ${feedbackScreen}

                    <div id="scenario-controls" style="text-align: center;">
                        ${!isSubmitted ? 
                            `
                            <button id="submit-scenario">${lang === 'ar' ? 'ุชูููู ุงูุฅุฌุฑุงุกุงุช' : 'รvaluer les Actions'}</button>
                            <button id="skip-scenario">${lang === 'ar' ? 'ุชุฌุงูุฒ ุงูุณููุงุฑูู' : 'Passer le Scรฉnario'}</button>
                            ` :
                            `<button id="next-scenario">${scenarioIndex < totalScenarios - 1 ? (lang === 'ar' ? 'ุงูุณููุงุฑูู ุงูุชุงูู' : 'Scรฉnario Suivant') : (lang === 'ar' ? 'ุนุฑุถ ุงููุชุงุฆุฌ ุงูููุงุฆูุฉ' : 'Afficher les Rรฉsultats')}</button>`
                        }
                    </div>
                </div>
            `;
        }

        // --- ุฏุงูุฉ ุชูููู ุงูุณููุงุฑูู ---
        function submitScenario(lang) {
            const scenario = shuffledScenarios[currentScenarioIndex];
            const selectedOptions = Array.from(document.querySelectorAll('.action-option.selected'));
            const selectedIndices = selectedOptions.map(opt => parseInt(opt.getAttribute('data-index')));
            
            let correctCount = 0;
            
            scenario.options.forEach((option, index) => {
                const isSelected = selectedIndices.includes(index);
                
                if (option.correct && isSelected) {
                    correctCount++;
                } else if (!option.correct && isSelected) {
                    correctCount--;
                } else if (option.correct && !isSelected) {
                    correctCount--;
                }
            });

            const totalPossibleCorrect = scenario.options.filter(o => o.correct).length;
            const scenarioScore = Math.max(0, correctCount);
            
            userAnswers[currentScenarioIndex] = {
                score: scenarioScore,
                selected: selectedIndices,
                maxScore: totalPossibleCorrect,
                skipped: false
            };
            
            history.replaceState(null, '', window.location.hash);
            renderApp(lang);
        }
        
        // --- ุฏุงูุฉ ุชุฌุงูุฒ ุงูุณููุงุฑูู ---
        function skipScenario() {
            const scenario = shuffledScenarios[currentScenarioIndex];
            const totalPossibleCorrect = scenario.options.filter(o => o.correct).length;
            
            // ุชุณุฌูู ุงูุณููุงุฑูู ูููุทุฉ ุตูุฑูุฉ ูููุชูุฌุงููุฒ
            userAnswers[currentScenarioIndex] = {
                score: 0,
                selected: [],
                maxScore: totalPossibleCorrect,
                skipped: true
            };
            
            // ุงูุงูุชูุงู ููุณููุงุฑูู ุงูุชุงูู
            currentScenarioIndex++;
            
            if (currentScenarioIndex < shuffledScenarios.length) {
                history.pushState(null, '', `#scenario_${currentScenarioIndex}`);
            } else {
                history.pushState(null, '', `#results`);
            }
            renderApp(currentLang);
        }


        // --- ูุงุฌูุฉ ุงูุชุบุฐูุฉ ุงูุฑุงุฌุนุฉ (Feedback) ---
        function generateFeedback(lang, scenarioIndex) {
            const scenario = shuffledScenarios[scenarioIndex];
            const result = userAnswers[scenarioIndex];
            
            // ุฅุฐุง ุชู ุชุฌุงูุฒ ุงูุณููุงุฑูู
            if (result.skipped) {
                return `<div style="margin-top: 20px; padding: 15px; border: 1px solid var(--accent-color); border-radius: 8px; text-align: center;">
                            <p style="color: var(--accent-color); font-weight: 700;">${lang === 'ar' ? 'ุชู ุชุฌุงูุฒ ูุฐุง ุงูุณููุงุฑูู.' : 'Scรฉnario ignorรฉ.'}</p>
                        </div>`;
            }

            let feedbackHtml = `<h4 style="color: var(--success-color); margin-top: 30px;">${lang === 'ar' ? 'ุชูููู ุงูุณููุงุฑูู:' : 'รvaluation du Scรฉnario:'}</h4>`;

            scenario.options.forEach((option, index) => {
                const isSelected = result.selected.includes(index);
                const isCorrect = option.correct;
                
                let statusClass = '';
                let statusIcon = '';
                let statusText = '';
                
                if (isSelected && isCorrect) {
                    statusClass = 'correct';
                    statusIcon = 'โ';
                    statusText = 'ุฅุฌุฑุงุก ุตุญูุญ ุชู ุงุฎุชูุงุฑู';
                } else if (isSelected && !isCorrect) {
                    statusClass = 'incorrect';
                    statusIcon = 'โ';
                    statusText = 'ุฅุฌุฑุงุก ุฎุงุทุฆ ุชู ุงุฎุชูุงุฑู (ุชู ุฎุตู ููุงุท)';
                } else if (!isSelected && isCorrect) {
                    statusClass = 'incorrect';
                    statusIcon = 'โ';
                    statusText = 'ุฅุฌุฑุงุก ุตุญูุญ ุชู ุฅุบูุงูู (ุชู ุฎุตู ููุงุท)';
                }
                
                if (statusClass) {
                     feedbackHtml += `
                         <div class="feedback-item ${statusClass}">
                            <span>${statusIcon}</span>
                            <strong>${option.text}</strong>
                            <span style="font-size: 0.9em; margin-right: auto; color: inherit;">(${statusText})</span>
                         </div>
                     `;
                }
            });
            
            const scoreMsg = lang === 'ar' ? 
                `ุงููุชูุฌุฉ ูู ูุฐุง ุงูุณููุงุฑูู: ${result.score} ููุทุฉ.` : 
                `Score pour ce scรฉnario: ${result.score} points.`;
                
            return `
                <div style="margin-top: 20px; border-top: 1px dashed #ccc; padding-top: 20px;">
                    <p style="font-weight: 700; color: var(--header-color); text-align: center;">${scoreMsg}</p>
                    ${feedbackHtml}
                </div>
            `;
        }

        // --- ูุงุฌูุฉ ุงููุชุงุฆุฌ ุงูููุงุฆูุฉ (Final Results) ---
        function generateFinalResultHTML(lang) {
            const maxScore = scenariosMaster[lang].reduce((sum, s) => sum + s.options.filter(o => o.correct).length, 0); 
            
            // ุญุณุงุจ ุงููุชูุฌุฉ ุงูุชุฑุงูููุฉ ููุท ููุณููุงุฑูููุงุช ุบูุฑ ุงููุชุฌุงูุฒุฉ
            const finalScore = userAnswers.reduce((sum, result) => sum + result.score, 0);

            const percentage = (finalScore / maxScore) * 100;

            let advice, ratingColor;

            if (lang === 'ar') {
                if (percentage >= 90) { advice = '๐ ููุชุงุฒ! ุณูุทุฑุฉ ูุงููุฉ ุนูู ุฅุฏุงุฑุฉ ุญุงูุงุช ุฏุงุก ุงูููุจ.'; ratingColor = 'var(--primary-color)'; }
                else if (percentage >= 80) { advice = '๐ ุฌูุฏ ุฌุฏุงู! ุฃุฏุงุก ูููุ ุฑุงุฌุน ุงูุณููุงุฑูููุงุช ุงูุชู ููุฏุช ูููุง ููุงุทูุง.'; ratingColor = 'var(--success-color)'; }
                else if (percentage >= 60) { advice = '๐ก ููุจูู. ุชุญุชุงุฌ ููุฑุงุฌุนุฉ ุงูุฅุฌุฑุงุกุงุช ุงูุฅูุฒุงููุฉ (IGAR ูุงูุฎูุงุทุฉ).'; ratingColor = 'var(--accent-color)'; }
                else { advice = 'โ ุถุนูู. ุจุญุงุฌุฉ ููุฑุงุฌุนุฉ ููุซูุฉ ูููุฑุฌุน ูุจู ุฅุนุงุฏุฉ ุงููุญุงููุฉ.'; ratingColor = 'var(--danger-color)'; }
            } else {
                 if (percentage >= 90) { advice = '๐ Excellent professionnel!'; ratingColor = 'var(--primary-color)'; }
                 else if (percentage >= 80) { advice = '๐ Performance remarquable!'; ratingColor = 'var(--success-color)'; }
                 else if (percentage >= 60) { advice = '๐ก Acceptable. Nรฉcessite une rรฉvision des procรฉdures clรฉs.'; ratingColor = 'var(--accent-color)'; }
                 else { advice = 'โ Faible. Rรฉvision intensive nรฉcessaire.'; ratingColor = 'var(--danger-color)'; }
            }
            
            const resultText = lang === 'ar' ? 
                `ุญุตูุช ุนูู ${finalScore} ููุทุฉ ูู ุฃุตู ${maxScore} ููุทุฉ ููููุฉ (${percentage.toFixed(1)}%).` : 
                `Vous avez obtenu ${finalScore} points sur ${maxScore} possibles (${percentage.toFixed(1)}%).`;
            
            return `
                <div class="card" style="text-align: center;">
                    <h3>${lang === 'ar' ? 'ุงููุชุงุฆุฌ ุงูููุงุฆูุฉ ูุชูููู ุงูุฃุฏุงุก' : 'Rรฉsultats Finaux et รvaluation'}</h3>
                    <p style="font-size: 1.5em; font-weight: 800; color: ${ratingColor};">${resultText}</p>
                    <p style="font-size: 1.2em; color: ${ratingColor};">${advice}</p>
                    <button onclick="history.pushState(null, '', '#start'); renderApp('${lang}');" id="restart-button" style="background-color: var(--success-color) !important; color: white;">${lang === 'ar' ? 'ุฅุนุงุฏุฉ ุงููุญุงููุฉ' : 'Recommencer'}</button>
                </div>
            `;
        }

        // =========================================================
        // 3. ููุทู ุงูุชุญูู ูุงูุชููู (Logic)
        // =========================================================

        const contentData = {
            ar: {
                sidebar_title: "ูุงุฆูุฉ ุงูุชููู", lang_toggle_text: "Franรงais", 
                nav_start: "๐ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ", nav_scenarios: "๐ง ุจุฏุก ุงููุญุงูู", nav_about: "โน๏ธ ูุนูููุงุช ุนู ุงูุชุทุจูู",
            },
             fr: {
                sidebar_title: "Menu de Navigation", lang_toggle_text: "ุงูุนุฑุจูุฉ", 
                nav_start: "๐ Accueil", nav_scenarios: "๐ง Dรฉmarrer le Simulateur", nav_about: "โน๏ธ ร Propos",
            },
        };
        
        function renderApp(lang) {
            const data = contentData[lang] || contentData['ar'];
            const footer = copyrightAr;
            const currentHash = window.location.hash || '#start';

            const navLinksHtml = `
                <li><a href="#start">${data.nav_start}</a></li>
                <li><a href="#scenarios">${data.nav_scenarios}</a></li>
                <li><a href="#about">${data.nav_about}</a></li>
            `;

            document.getElementById('sidebar').innerHTML = `
                <button id="lang-toggle">${data.lang_toggle_text}</button>
                <h2>${data.sidebar_title}</h2>
                <ul id="nav-links">${navLinksHtml}</ul>
            `;
            
            let contentHtml = '';

            if (currentHash === '#start') {
                contentHtml = generateStartScreen(lang);
            } else if (currentHash === '#scenarios' || currentHash.startsWith('#scenario_')) {
                const match = currentHash.match(/#scenario_(\d+)/);
                currentScenarioIndex = match ? parseInt(match[1]) : 0;
                
                if (currentScenarioIndex < shuffledScenarios.length) {
                    contentHtml = generateScenarioHTML(lang, currentScenarioIndex);
                } else {
                    history.replaceState(null, '', `#results`);
                    contentHtml = generateFinalResultHTML(lang);
                }
            } else if (currentHash === '#results') {
                contentHtml = generateFinalResultHTML(lang);
            } else if (currentHash === '#about') {
                 contentHtml = `<div class="card" style="text-align: center;">
                                    <h3>${lang === 'ar' ? 'ูุนูููุงุช ุนู ุงูุชุทุจูู' : 'About the App'}</h3>
                                    <p>${lang === 'ar' ? 'ุชู ุชุทููุฑ ูุฐุง ุงููุญุงูู ุงูุชุนูููู ุจูุงุณุทุฉ ุญููุฏูุด ุนุจุฏ ุงูุชูุงุจุ ุงููุฎุชุต ูู ุญูุธ ุงูุตุญุฉุ ูุบุฑุถ ุงูุชุณููู ูุงูุชุฏุฑูุจ ุงูุนููู ุนูู ุจุฑูุชููููุงุช ุฏุงุก ุงูููุจ ุงููุนุชูุฏุฉ ูู ูุตูุญุฉ ุนูู ุงูุฃูุจุฆุฉ ูุงูุทุจ ุงูููุงุฆู.' : 'This simulator was developed by Hamidouche Abdeetouab, Health Specialist, to facilitate practical training on rabies protocols.'}</p>
                                    <p>${lang === 'ar' ? 'ุงููุคุณุณุฉ: ุงููุคุณุณุฉ ุงูุนููููุฉ ููุตุญุฉ ุงูุฌูุงุฑูุฉ ุจุฑุฌ ููุงูู.' : 'Institution: E.P.S.P. Bordj Menaiel.'}</p>
                                </div>`;
            }
            
            document.getElementById('main-content').innerHTML = `<div class="content-wrapper">${contentHtml}</div> ${footer}`; 
            
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
            setBackButtonSymbol(lang);
            attachEventListeners(); 
            updateActiveLink(); 
        }

        // =========================================================
        // 4. ุฑุจุท ุงูุฃุญุฏุงุซ (ุงููุตุญุญ ูุถูุงู ุนูู ุงูุฃุฒุฑุงุฑ)
        // =========================================================
        
        function attachEventListeners() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            
            // 1. ุฑุจุท ุงูุฃุญุฏุงุซ ุงูุฏููุงููููุฉ (ุงูุฃุฒุฑุงุฑ ุฏุงุฎู main-content)
            
            // ุฒุฑ ุจุฏุก ุงููุนุจุฉ
            const startButton = document.getElementById('start-button');
            if (startButton) {
                 startButton.onclick = () => {
                    shuffledScenarios = shuffleArray(scenariosMaster[currentLang]);
                    currentScenarioIndex = 0;
                    userAnswers = []; 
                    
                    history.pushState(null, '', `#scenario_0`);
                    renderApp(currentLang);
                 };
            }

            // ุฒุฑ ุชูููู ุงูุฅุฌุฑุงุกุงุช
            const submitButton = document.getElementById('submit-scenario');
            if (submitButton) {
                submitButton.onclick = () => submitScenario(currentLang);
            }
            
            // [ุฌุฏูุฏ] ุฒุฑ ุชุฌุงูุฒ ุงูุณููุงุฑูู
            const skipButton = document.getElementById('skip-scenario');
            if (skipButton) {
                 skipButton.onclick = skipScenario;
            }

            // ุฒุฑ ุงูุณููุงุฑูู ุงูุชุงูู
            const nextButton = document.getElementById('next-scenario');
            if (nextButton) {
                nextButton.onclick = () => {
                    currentScenarioIndex++;
                    if (currentScenarioIndex < shuffledScenarios.length) {
                        history.pushState(null, '', `#scenario_${currentScenarioIndex}`);
                    } else {
                        history.pushState(null, '', `#results`);
                    }
                    renderApp(currentLang);
                };
            }
            
            // ูุนุงูุฌุฉ ุงุฎุชูุงุฑ ุงูุฅุฌุฑุงุกุงุช
            const actionsContainer = document.getElementById('action-options');
            if (actionsContainer) {
                actionsContainer.onclick = function(e) {
                    if (e.target.classList.contains('action-option') && userAnswers[currentScenarioIndex] === undefined) {
                        e.target.classList.toggle('selected');
                    }
                };
            }

            // ุฅุบูุงู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ุนูุฏ ุงูููุฑ ุฎุงุฑุฌูุง
            mainContent.onclick = function(e) {
                if (window.innerWidth <= 992 && sidebar.classList.contains('open') && !sidebar.contains(e.target) && e.target.id !== 'hamburger-menu') {
                    sidebar.classList.remove('open');
                }
            };
            
            // 3. ุฑุจุท ุงูุฃุญุฏุงุซ ูุฑูุงุจุท ุงูุดุฑูุท ุงูุฌุงูุจู (ุชุฌูุจ ุชูุฑุงุฑ ุงูุฑุจุท)
            document.querySelectorAll('.sidebar ul li a').forEach(link => { 
                 const clone = link.cloneNode(true);
                 link.parentNode.replaceChild(clone, link);

                 clone.addEventListener('click', (e) => { 
                    e.preventDefault(); 
                    const targetId = clone.getAttribute('href');
                    
                    if (targetId === '#scenarios') {
                        shuffledScenarios = shuffleArray(scenariosMaster[currentLang]);
                        currentScenarioIndex = 0;
                        userAnswers = []; 
                        history.pushState(null, '', `#scenario_0`);
                    } else {
                        history.pushState(null, '', targetId);
                    }
                    renderApp(currentLang); 
                    if (window.innerWidth <= 992) { sidebar.classList.remove('open'); } 
                 }); 
            });
        }

        function updateActiveLink() {
            const currentHash = window.location.hash;
            let activeLink = '#start';
            
            if (currentHash === '#about') {
                 activeLink = '#about';
            } else if (currentHash.startsWith('#scenario') || currentHash === '#results' || currentHash === '#scenarios') {
                 activeLink = '#scenarios';
            } else if (currentHash === '#start' || currentHash === '') {
                 activeLink = '#start';
            }

            document.querySelectorAll('.sidebar ul li a').forEach(link => { 
                link.classList.remove('active');
                if (link.getAttribute('href') === activeLink) { 
                    link.classList.add('active'); 
                } 
            });
        }
        
        // =========================================================
        // 6. ุงูุชุญููู ุงูุฃููู
        // =========================================================

        document.addEventListener('DOMContentLoaded', function () {
            // ุฑุจุท ุฃุฒุฑุงุฑ ุงูุชุญูู ุงูุซุงุจุชุฉ (ูุฑุฉ ูุงุญุฏุฉ)
            const sidebar = document.getElementById('sidebar');
            const hamburgerMenu = document.getElementById('hamburger-menu');
            const backButton = document.getElementById('back-button'); 

            hamburgerMenu.onclick = () => sidebar.classList.toggle('open');
            backButton.onclick = () => window.history.back();
            
            const langToggle = document.getElementById('lang-toggle');
            if (langToggle) langToggle.onclick = () => { 
                currentLang = currentLang === 'ar' ? 'fr' : 'ar'; 
                history.replaceState(null, '', window.location.hash || '#start'); 
                renderApp(currentLang); 
            };

            window.onpopstate = () => {
                renderApp(currentLang);
            };

            // ุชููุฆุฉ ุงูุณููุงุฑูููุงุช ุงููุฎูุทุฉ ุนูุฏ ุฃูู ุชุญููู
            if (shuffledScenarios.length === 0) {
                 shuffledScenarios = shuffleArray(scenariosMaster[currentLang]);
            }
            
            if (!window.location.hash) {
                history.replaceState(null, '', '#start');
            }
            renderApp(currentLang); 
        });
    </script>
</body>
</html>